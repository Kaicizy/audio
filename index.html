<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOMMASO SLOT MACHINE</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Tone.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Casino style background */
            background: radial-gradient(circle at center, #3a0e0e 0%, #0d0404 100%); /* Dark red radial gradient */
            color: #e2e8f0; /* Light text */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden; /* Prevent scroll for subtle effects */
        }

        .slot-container {
            background: linear-gradient(145deg, #2d3748, #1a202c);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7), 0 0 0 5px rgba(255, 255, 255, 0.08); /* More prominent shadow */
            padding: 30px;
            text-align: center;
            width: 100%;
            max-width: 550px; /* Slightly wider for the lever */
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .main-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px; /* Space between reels and lever */
            width: 100%;
        }

        .reels-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .reels-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .reel {
            background-color: #2c3e50;
            border: 3px solid #63b3ed;
            border-radius: 15px;
            width: 90px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .reel .symbol {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Copri l'area, tagliando se necessario */
            border-radius: 12px; /* Abbina il raggio del bordo del rullo */
            display: block;
        }

        /* Keyframes per l'animazione di rotazione - adattato per le immagini */
        @keyframes spin {
            0% { transform: translateY(-200%); opacity: 0.5; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .reel.spinning .symbol {
            animation: spin 0.2s linear infinite; /* Rotazione veloce durante l'animazione */
        }

        /* Animazione specifica per l'apparizione del simbolo finale */
        @keyframes final-spin {
            0% { transform: translateY(-200%); opacity: 0; }
            50% { transform: translateY(10%); opacity: 1; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .reel.result .symbol {
            animation: final-spin 0.5s ease-out forwards;
        }

        .message-box {
            background-color: #2d3748;
            border: 2px solid #4a5568;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 1.1rem;
            min-height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease-in-out;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.2);
            width: 100%; /* Assicura che la casella dei messaggi occupi l'intera larghezza */
        }

        .message-box.win {
            background-color: #2f855a; /* Verde per la vittoria */
            border-color: #38a169;
            color: #d1fae5;
            animation: pulse-green 1s infinite alternate;
        }

        .message-box.lose {
            background-color: #c53030; /* Rosso per la sconfitta */
            border-color: #e53e3e;
            color: #fed7d7;
            animation: shake 0.5s;
        }

        @keyframes pulse-green {
            from { box-shadow: 0 0 0 0 rgba(49, 196, 141, 0.7); }
            to { box-shadow: 0 0 0 10px rgba(49, 196, 141, 0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Stili della leva - Migliorati */
        .lever-container {
            width: 80px;
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            cursor: pointer;
            position: relative;
            user-select: none;
            margin-left: 20px;
            perspective: 1000px; /* Per la trasformazione 3D */
        }

        .lever-base {
            width: 70px; /* Base leggermente più larga */
            height: 60px; /* Base più alta */
            background-color: #5a3b2b; /* Marrone scuro */
            border-radius: 15px; /* Più arrotondato */
            box-shadow: inset 0 -8px 15px rgba(0, 0, 0, 0.7), 0 5px 15px rgba(0, 0, 0, 0.5); /* Ombra più profonda */
            position: absolute;
            bottom: 0;
            border: 2px solid #6d4c41; /* Bordo marrone più chiaro */
            z-index: 1; /* Assicura che sia dietro la maniglia visivamente */
        }

        .lever-handle {
            width: 30px; /* Maniglia leggermente più larga */
            height: 180px;
            background: linear-gradient(to top, #7e57c2, #5e35b1); /* Gradiente viola per un aspetto metallico */
            border-radius: 15px; /* Più arrotondato */
            position: absolute;
            top: 20px;
            transform-origin: center bottom;
            transition: transform 0.1s ease-out, top 0.1s ease-out; /* Movimento fluido */
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3), inset 0 0 10px rgba(255, 255, 255, 0.2); /* Lieve lucentezza */
            border: 2px solid #4527a0; /* Bordo viola più scuro */
        }

        .lever-handle.pulled {
            transform: rotateX(10deg) rotateZ(30deg) translateY(15px); /* Tirata 3D più pronunciata */
            top: 25px; /* Sposta leggermente verso il basso */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5), inset 0 0 5px rgba(255, 255, 255, 0.1);
        }

        .lever-knob {
            width: 45px; /* Pomello leggermente più grande */
            height: 45px;
            background: radial-gradient(circle at top left, #ff5f6d, #ffc371); /* Gradiente caldo e brillante */
            border-radius: 50%;
            position: absolute;
            top: -10px; /* Solleva leggermente il pomello sopra la maniglia */
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 5px 20px rgba(255, 95, 109, 0.6), inset 0 0 10px rgba(255, 255, 255, 0.5); /* Bagliore più forte e lucentezza interna */
            border: 3px solid #f8d0a4; /* Bordo più chiaro per contrasto */
        }

        .lever-container.disabled .lever-handle,
        .lever-container.disabled .lever-knob {
            opacity: 0.7; /* Rendili leggermente trasparenti */
            cursor: not-allowed;
            filter: grayscale(50%); /* Desatura leggermente quando disabilitato */
        }
        
        /* Regolazioni responsive */
        @media (max-width: 600px) {
            .slot-container {
                padding: 15px;
                max-width: 95%;
            }
            .main-content {
                flex-direction: column; /* Impila rulli e leva su schermi piccoli */
                gap: 25px;
            }
            .reels-container {
                gap: 10px;
                margin-bottom: 20px;
            }
            .reel {
                width: 70px;
                height: 80px;
            }
            .message-box {
                font-size: 1rem;
                padding: 10px;
                min-height: 50px;
            }
            .lever-container {
                width: 60px;
                height: 200px;
                margin-left: 0; /* Nessun margine quando impilato */
                margin-top: 20px; /* Spazio dai rulli sopra */
            }
            .lever-base {
                width: 50px;
                height: 40px;
            }
            .lever-handle {
                width: 20px;
                height: 140px;
                top: 15px;
            }
            .lever-knob {
                width: 30px;
                height: 30px;
                top: -5px; /* Regola la posizione del pomello per una maniglia più piccola */
            }
        }
    </style>
</head>
<body>
    <div class="slot-container">
        <h1 class="text-3xl font-bold mb-6 text-yellow-300">TOMMASO SLOT MACHINE</h1>

        <div class="flex justify-between items-center mb-4 px-4 py-2 bg-gray-700 rounded-lg shadow-inner w-full">
            <span class="text-lg font-semibold">Crediti:</span>
            <span id="balance" class="text-2xl font-bold text-yellow-400">100</span>
        </div>

        <div class="main-content">
            <div class="reels-wrapper">
                <div class="reels-container">
                    <div id="reel1" class="reel">
                        <img class="symbol" src="" alt="simbolo slot">
                    </div>
                    <div id="reel2" class="reel">
                        <img class="symbol" src="" alt="simbolo slot">
                    </div>
                    <div id="reel3" class="reel">
                        <img class="symbol" src="" alt="simbolo slot">
                    </div>
                </div>
            </div>

            <div id="leverContainer" class="lever-container">
                <div id="leverHandle" class="lever-handle">
                    <div class="lever-knob"></div>
                </div>
                <div class="lever-base"></div>
            </div>
        </div>

        <div id="messageBox" class="message-box">
            Tira la leva per iniziare!
        </div>
    </div>

    <script>
        const reels = [
            document.getElementById('reel1'),
            document.getElementById('reel2'),
            document.getElementById('reel3')
        ];
        const leverContainer = document.getElementById('leverContainer');
        const leverHandle = document.getElementById('leverHandle');
        const balanceDisplay = document.getElementById('balance');
        const messageBox = document.getElementById('messageBox');

        // Suono di sconfitta: URL RAW da GitHub Pages
        // Devi sostituire "kaicizy.github.io/audio" con l'URL base della tua GitHub Page, se diverso!
        const loseSoundPlayer = new Tone.Player({
            url: ["https://kaicizy.github.io/audio/perdita.mp3"], // URL come array
            onload: () => console.log('Suono di perdita caricato con successo!'),
            onerror: (e) => console.error('Errore caricamento suono di perdita:', e, 'URL:', "https://kaicizy.github.io/audio/perdita.mp3")
        }).toDestination();


        const spinSynth = new Tone.MetalSynth({
            frequency: 200,
            envelope: {
                attack: 0.001,
                decay: 0.05,
                sustain: 0.01,
                release: 0.05,
            },
            harmonicity: 5.1,
            modulationIndex: 32,
            resonance: 4000,
            octaves: 1.5,
        }).toDestination();
        const spinVolume = new Tone.Volume(-15).toDestination();
        spinSynth.connect(spinVolume);

        // Suoni di vincita specifici: URL RAW da GitHub Pages
        // Devi sostituire "kaicizy.github.io/audio" con l'URL base della tua GitHub Page, se diverso!
        const winSounds = {
            'manHelmetmanHelmetmanHelmet': new Tone.Player({
                url: ["https://kaicizy.github.io/audio/arrecreat.mp3"], // URL come array
                onload: () => console.log('Suono caricato per manHelmetmanHelmetmanHelmet (Jackpot)!'),
                onerror: (e) => console.error('Errore caricamento suono per manHelmetmanHelmetmanHelmet:', e, 'URL:', "https://kaicizy.github.io/audio/arrecreat.mp3")
            }).toDestination(),
            'manHandToFacemanHandToFacemanHandToFace': new Tone.Player({
                url: ["https://kaicizy.github.io/audio/avvoca.mp3"], // URL come array
                onload: () => console.log('Suono caricato per manHandToFacemanHandToFacemanHandToFace!'),
                onerror: (e) => console.error('Errore caricamento suono per manHandToFacemanHandToFacemanHandToFace:', e, 'URL:', "https://kaicizy.github.io/audio/avvoca.mp3")
            }).toDestination(),
            'manSuitmanSuitmanSuit': new Tone.Player({
                url: ["https://kaicizy.github.io/audio/finitela.mp3"], // URL come array
                onload: () => console.log('Suono caricato per manSuitmanSuitmanSuit!'),
                onerror: (e) => console.error('Errore caricamento suono per manSuitmanSuitmanSuit:', e, 'URL:', "https://kaicizy.github.io/audio/finitela.mp3")
            }).toDestination(),
            'soldierGunsoldierGunsoldierGun': new Tone.Player({
                url: ["https://kaicizy.github.io/audio/nun%20mbort.mp3"], // URL come array
                onload: () => console.log('Suono caricato per soldierGunsoldierGunsoldierGun!'),
                onerror: (e) => console.error('Errore caricamento suono per soldierGunsoldierGunsoldierGun:', e, 'URL:', "https://kaicizy.github.io/audio/nun%20mbort.mp3")
            }).toDestination(),
            'manSkiJacketmanSkiJacketmanSkiJacket': new Tone.Player({
                url: ["https://kaicizy.github.io/audio/sparamm.mp3"], // URL come array
                onload: () => console.log('Suono caricato per manSkiJacketmanSkiJacketmanSkiJacket!'),
                onerror: (e) => console.error('Errore caricamento suono per manSkiJacketmanSkiJacketmanSkiJacket:', e, 'URL:', "https://kaicizy.github.io/audio/sparamm.mp3")
            }).toDestination(),
            'manJesusCostumemanJesusCostumemanJesusCostume': new Tone.Player({
                url: ["https://kaicizy.github.io/audio/tagliola.mp3"], // URL come array
                onload: () => console.log('Suono caricato per manJesusCostumemanJesusCostumemanJesusCostume!'),
                onerror: (e) => console.error('Errore caricamento suono per manJesusCostumemanJesusCostumemanJesusCostume:', e, 'URL:', "https://kaicizy.github.io/audio/tagliola.mp3")
            }).toDestination(),
            'distortedFacedistortedFacedistortedFace': new Tone.Player({
                url: ["https://kaicizy.github.io/audio/teatro.mp3"], // URL come array
                onload: () => console.log('Suono caricato per distortedFacedistortedFacedistortedFace!'),
                onerror: (e) => console.error('Errore caricamento suono per distortedFacedistortedFacedistortedFace:', e, 'URL:', "https://kaicizy.github.io/audio/teatro.mp3")
            }).toDestination()
        };


        // Symbols for the slot machine, now using image URLs (percorsi relativi)
        // ASSICURATI DI CARICARE LE IMMAGINI IN UNA CARTELLA 'images' NELLA ROOT DEL TUO REPOSITORY GITHUB PAGES!
        const symbols = [
            { id: 'manSkiJacket', url: 'images/WhatsApp Image 2025-06-19 at 19.38.53 (1).jpeg', alt: 'Uomo con giacca da sci' },
            { id: 'manJesusCostume', url: 'images/WhatsApp Image 2025-06-19 at 19.29.12.jpeg', alt: 'Uomo in costume da Gesù' },
            { id: 'distortedFace', url: 'images/WhatsApp Image 2025-06-19 at 19.25.10.jpeg', alt: 'Faccia distorta' }, /* Corretto da .jpg a .jpeg */
            { id: 'soldierGun', url: 'images/WhatsApp Image 2025-06-19 at 19.38.53 (1) - Copia.jpeg', alt: 'Soldato con fucile' },
            { id: 'manSuit', url: 'images/WhatsApp Image 2025-06-19 at 19.38.53.jpeg', alt: 'Uomo in completo' },
            { id: 'manHandToFace', url: 'images/WhatsApp Image 2025-06-19 at 19.38.54 (1).jpeg', alt: 'Uomo con mano sul viso' },
            { id: 'manHelmet', url: 'images/WhatsApp Image 2025-06-19 at 19.38.54.jpeg', alt: 'Uomo con casco' } /* Corretto da .jpg a .jpeg */
        ];

        const spinCost = 10;
        let balance = 100;

        // Nuove percentuali di probabilità per le vincite
        const baseWinChance = 0.60; // 60% di possibilità di avere un "bias" verso la vincita
        const tripleMatchBiasChance = 0.40; // Di quel 60%, 40% sarà una tripletta (quindi 60%*40% = 24% di tripletta forzata)

        const winMultipliers = {
            // Combinazioni triple, usando gli ID delle immagini
            'manHelmetmanHelmetmanHelmet': 500, // Jackpot!
            'manHandToFacemanHandToFacemanHandToFace': 250,
            'manSuitmanSuitmanSuit': 150,
            'soldierGunsoldierGunsoldierGun': 100,
            'manSkiJacketmanSkiJacketmanSkiJacket': 50,
            'manJesusCostumemanJesusCostumemanJesusCostume': 30,
            'distortedFacedistortedFacedistortedFace': 20,
        };

        /**
         * Aggiorna la visualizzazione del saldo corrente.
         */
        function updateBalanceDisplay() {
            balanceDisplay.textContent = balance;
        }

        /**
         * Riproduce uno specifico effetto sonoro.
         * @param {string} type 'lose' per un suono di sconfitta, 'spin' per un suono di rotazione, o una chiave di vincita (es. 'manHelmetmanHelmetmanHelmet').
         * @param {string} action 'start' per avviare il suono, 'stop' per fermarlo (rilevante solo per 'spin').
         */
        function playSound(type, action = 'start') {
            if (type === 'lose') {
                if (loseSoundPlayer.loaded) {
                    loseSoundPlayer.start();
                } else {
                    console.warn(`Il suono di perdita non è ancora caricato o non è accessibile. URL: ${loseSoundPlayer.url}`);
                }
            } else if (type === 'spin') {
                if (action === 'start') {
                    spinSynth.loop = new Tone.Loop(time => {
                        spinSynth.triggerAttackRelease(Math.random() * 200 + 100, '16n', time);
                    }, '16n').start(0);
                } else if (action === 'stop') {
                    if (spinSynth.loop) {
                        spinSynth.loop.stop();
                        spinSynth.loop.dispose();
                        spinSynth.loop = null;
                    }
                    spinSynth.triggerRelease();
                }
            } else if (winSounds[type]) { // Se il tipo corrisponde a una chiave di vincita
                // Prima di riprodurre, assicurati che il player sia caricato e pronto
                if (winSounds[type].loaded) {
                    winSounds[type].start();
                } else {
                    console.warn(`Il suono per la vincita "${type}" non è ancora caricato o non è accessibile. Controlla il link o i permessi di GitHub Pages. URL: ${winSounds[type].url}`);
                }
            }
        }

        /**
         * Visualizza un messaggio all'utente, opzionalmente con uno stile specifico per vittoria/sconfitta.
         * @param {string} message Il messaggio da visualizzare.
         * @param {string} type Opzionale. 'win' o 'lose' per applicare uno stile specifico.
         */
        function showMessage(message, type = '') {
            messageBox.textContent = message;
            messageBox.classList.remove('win', 'lose');
            if (type) {
                messageBox.classList.add(type);
            }
        }

        /**
         * Simula l'animazione di rotazione di un singolo rullo.
         * @param {HTMLElement} reelElement L'elemento HTML del rullo.
         * @returns {Promise<void>} Una promessa che si risolve quando il rullo smette di girare.
         */
        function spinReel(reelElement) {
            return new Promise(resolve => {
                const symbolElement = reelElement.querySelector('.symbol');
                reelElement.classList.add('spinning');

                let spinInterval;
                let spinCount = 0;
                const totalSpins = 30;

                spinInterval = setInterval(() => {
                    if (spinCount < totalSpins) {
                        const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                        symbolElement.src = randomSymbol.url;
                        symbolElement.alt = randomSymbol.alt;
                        symbolElement.onerror = () => {
                            symbolElement.src = `https://placehold.co/90x100/000000/FFFFFF?text=Error`;
                            symbolElement.alt = `Errore di caricamento immagine`;
                        };
                        spinCount++;
                    } else {
                        clearInterval(spinInterval);
                        reelElement.classList.remove('spinning');
                        resolve();
                    }
                }, 50);
            });
        }

        /**
         * Ferma un singolo rullo su un simbolo specifico e anima la sua apparizione finale.
         * @param {HTMLElement} reelElement L'elemento HTML del rullo.
         * @param {object} finalSymbol L'oggetto simbolo (con id, url, alt) su cui fermarsi.
         */
        function stopReel(reelElement, finalSymbol) {
            const symbolElement = reelElement.querySelector('.symbol');
            reelElement.classList.add('result');
            symbolElement.src = finalSymbol.url;
            symbolElement.alt = finalSymbol.alt;
            symbolElement.onerror = () => {
                symbolElement.src = `https://placehold.co/90x100/000000/FFFFFF?text=Error`;
                symbolElement.alt = `Errore di caricamento immagine`;
            };
            setTimeout(() => {
                reelElement.classList.remove('result');
            }, 500);
        }

        /**
         * Determina il risultato del giro e aggiorna il saldo.
         * @param {object[]} resultSymbols Un array di oggetti simbolo visualizzati sui rulli.
         */
        function checkResult(resultSymbols) {
            playSound('spin', 'stop'); // Ferma il suono di rotazione

            const resultIds = resultSymbols.map(s => s.id);
            const resultString = resultIds.join('');
            let winAmount = 0;
            let message = '';
            let messageType = '';

            // Controlla le combinazioni triple (corrispondenza esatta di tutti e tre i simboli)
            if (resultIds[0] === resultIds[1] && resultIds[1] === resultIds[2]) {
                winAmount = winMultipliers[resultString] || 0;
                if (winAmount > 0) {
                    message = `Hai vinto ${winAmount} crediti! Congratulazioni! 🎉`;
                    messageType = 'win';
                    playSound(resultString); // Riproduci il suono di vincita specifico
                }
            } else {
                // Nessuna vincita se non ci sono tre simboli uguali
                message = 'Non hai vinto nulla. Riprova! 😕';
                messageType = 'lose';
                playSound('lose'); // Riproduci il suono di sconfitta
            }

            updateBalanceDisplay();
            showMessage(message, messageType);

            // Riattiva la leva dopo un leggero ritardo per permettere alle animazioni di finire
            setTimeout(() => {
                leverContainer.classList.remove('disabled');
                leverHandle.classList.remove('pulled');
            }, 700);
        }

        /**
         * Genera un array di simboli per i rulli.
         * @returns {object[]} Un array di simboli con bias di vincita o casuale.
         */
        function generateReelSymbols() {
            const resultSymbols = [];
            const willBiasWin = Math.random() < baseWinChance; // Determina se applicare il "bias" di vincita

            if (willBiasWin) {
                // Applica il bias per una vincita (forzando una tripletta)
                const winningSymbolIndex = Math.floor(Math.random() * symbols.length);
                const chosenWinningSymbol = symbols[winningSymbolIndex];

                // Tutti e tre i rulli avranno lo stesso simbolo
                resultSymbols.push(chosenWinningSymbol);
                resultSymbols.push(chosenWinningSymbol);
                resultSymbols.push(chosenWinningSymbol);

            } else {
                // Nessun bias di vincita, risultato completamente casuale (più probabilità di perdere)
                for (let i = 0; i < reels.length; i++) {
                    const randomIndex = Math.floor(Math.random() * symbols.length);
                    resultSymbols.push(symbols[randomIndex]);
                }
            }

            // Mischia i simboli per non farli apparire sempre in ordine (migliora l'estetica)
            for (let i = resultSymbols.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [resultSymbols[i], resultSymbols[j]] = [resultSymbols[j], resultSymbols[i]];
            }
            return resultSymbols;
        }

        /**
         * Handles the click event for the lever.
         */
        leverContainer.addEventListener('click', async () => {
            // Assicurati che il contesto audio sia attivo al primo clic
            if (Tone.context.state !== 'running') {
                await Tone.start();
                console.log('Contesto audio avviato');
            }

            if (leverContainer.classList.contains('disabled')) {
                return;
            }

            if (balance < spinCost) {
                showMessage('Crediti insufficienti! 😢', 'lose');
                playSound('lose');
                return;
            }

            leverHandle.classList.add('pulled');

            balance -= spinCost;
            updateBalanceDisplay();
            leverContainer.classList.add('disabled');
            showMessage('Gira...', '');

            playSound('spin', 'start'); // Avvia il suono di rotazione

            const resultSymbols = generateReelSymbols(); // Genera i simboli qui

            const spinPromises = [];

            // Inizia a far girare tutti i rulli contemporaneamente
            for (let i = 0; i < reels.length; i++) {
                spinPromises.push(spinReel(reels[i]));
            }

            // Attendi che tutti i rulli finiscano l'animazione
            await Promise.all(spinPromises);

            // Ferma progressivamente ogni rullo
            for (let i = 0; i < reels.length; i++) {
                stopReel(reels[i], resultSymbols[i]);
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            checkResult(resultSymbols);
        });

        // Setup iniziale al caricamento
        window.onload = function() {
            // Promemoria IMPORTANTE per l'utente:
            console.log("Per le IMMAGINI: crea una cartella 'images' nella ROOT del tuo repository GitHub Pages e carica lì le 7 immagini. I percorsi nel codice sono relativi a quella cartella.");
            console.log("Per gli AUDIO: assicurati che i file MP3 siano nella cartella 'audio' nella ROOT del tuo repository GitHub Pages. Gli URL nel codice sono stati impostati come https://kaicizy.github.io/audio/nome_file.mp3.");

            updateBalanceDisplay();
            reels.forEach(reel => {
                const symbolElement = reel.querySelector('.symbol');
                const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                symbolElement.src = randomSymbol.url;
                symbolElement.alt = randomSymbol.alt;
                symbolElement.onerror = () => {
                    symbolElement.src = `https://placehold.co/90x100/000000/FFFFFF?text=Error`;
                    symbolElement.alt = `Errore di caricamento immagine`;
                };
            });
            // Pre-carica i suoni al caricamento della pagina per essere pronti all'uso.
            loseSoundPlayer.load(); // Carica il suono di perdita
            for (const key in winSounds) {
                winSounds[key].load();
            }
        };
    </script>
</body>
</html>